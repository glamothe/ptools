\documentclass[12pt,a4paper]{article}
\usepackage{ae}
\usepackage{aecompl}
%\usepackage[cm]{aeguill}
\textwidth 16.5cm \textheight 26cm \oddsidemargin -0.5cm \topmargin -2cm
\usepackage{graphicx} % figures
\usepackage{lineno}

\begin{document}


\title{PTools tutorial}
\maketitle

\thispagestyle{empty}

\begin{figure}[htbp]
\center
\includegraphics*[width=0.80\linewidth]{img/docking.png}
\end{figure}


\vspace*{3cm}

\noindent
This tutorial presents the PTools library features and its docking application ATTRACT.

\newpage

\tableofcontents{}

\newpage

\section{Set up, compilation and installation}

\subsection{Set up: Dell D420 laptop, Debian Lenny, 32-bit}
This example installation has been performed on a Dell D420 laptop (Intel
Core Duo 1.2~GHz, Debian Lenny, linux kernel 2.6.22-2-686).

The basic requirements are:
\begin{itemize}
\item Python 2.4 or 2.5 and its development library (python2.4-dev or python2.5-dev)
\item gcc (4.x)
\item gfortran (4.x)
\end{itemize}

\paragraph{SCons (make substitute):} {\tt apt-get install scons} \\
(1.34.1-11 version installed)


\paragraph{Boost C++ Libraries} {\tt apt-get install libboost-dev} \\
(1.34.1-11 version installed)


\paragraph{Boost Python Library:} {\tt apt-get install libboost-python} \\
(1.34.1-11 version installed)


\paragraph{libboost Python dev:} {\tt apt-get install libboost-python-dev} \\
(1.34.1-11 version installed)

\paragraph{Subversion:} {\tt apt-get install subversion subversion-tools} \\
(1.4.6dfsg1-2 version installed)

\paragraph{gccxml:} {\tt apt-get install gccxml} \\
(0.9.0+cvs20071228-2 version installed)

Some Ubuntu linux distribution have an incompatible gccxml 0.7 version that crashes when parsing headers files. The solution is to install gccxml from the official CVS repository ( {\tt http://www.gccxml.org/HTML/Download.html} )


\paragraph{Pyplusplus and Pygccxml: }
The homepage of {\tt pyplusplus} and {\tt pygccxml} projects is 
{\tt http://www.language-binding.net/pyplusplus/pyplusplus.html}. From the
download section \footnote{\tt https://sourceforge.net/project/showfiles.php?group\_id=118209}, 
get the files {\tt pygccxml-0.9.5.zip} and {\tt Py++-0.9.5.zip}.

\begin{verbatim}
unzip pygccxml-0.9.5.zip
cd pygccxml-0.9.5/
python setup.py build
python setup.py install --prefix=$HOME/soft
\end{verbatim}

\begin{verbatim}
unzip Py++-0.9.5.zip 
cd Py++-0.9.5/
python setup.py build
python setup.py install --prefix=$HOME/soft
\end{verbatim}

In your {\tt \$HOME/.bashrc} file, then add:
\begin{verbatim}
export PATH=PATH:$HOME/soft/bin/
export PYTHONPATH=$HOME/soft/lib/python2.4/site-packages/
\end{verbatim}

In a Python shell (obtained with the {\tt python} command), test the installation
of PyPlusPlus:
\begin{verbatim}
>>> import pyplusplus
\end{verbatim}


\subsection{Set up: Dell Precision T7400, Linux Fedora Core 9, 64-bit}
This example installation has been performed on a Dell Precision T7400 (Intel
Xeon quad-core 2.3~GHz, Linux Fedora Core 9, linux kernel 2.6.25.6-55.FC9.x86\_64).

The basic requirements are:
\begin{itemize}
\item Python 2.5 and its development library python2.5-dev
\item gcc (4.x)
\item gfortran (4.x)
\end{itemize}

\paragraph{SCons (make substitute):}
The scons package provided by Fedora is not up-to-date enough to link Fortran and C++ together and then rise an
error. The last version of scons is obtained at the homepage of the project ({\tt  http://www.scons.org/}).
From the download section \footnote{\tt http://sourceforge.net/project/showfiles.php?group\_id=30337}, 
get the stable file {\tt scons-0.98.5-1.noarch.rpm}.

\begin{verbatim}
 rpm -ivh scons-0.98.5-1.noarch.rpm
\end{verbatim}

\paragraph{Boost C++ Libraries:} {\tt yum install boost boost-devel} \\
(1.34.1-13 version installed)


\paragraph{Python dev:} {\tt yum install python-devel} \\
(2.5.1-26 version installed)

\paragraph{Subversion:} {\tt yum install subversion} \\
(1.4.6-7 version installed)

\paragraph{gccxml:}The homepage of {\tt gccxml} project is {\tt http://www.gccxml.org}. 
To install gccxml from the official CVS repository \footnote{\tt http://www.gccxml.org/HTML/Download.html}.

\begin{verbatim}
cvs -d :pserver:anoncvs@www.gccxml.org:/cvsroot/GCC_XML login
\end{verbatim}
(just press enter when prompted for a password)\\
Follow this command by checking out the source code:
\begin{verbatim}
cvs -d :pserver:anoncvs@www.gccxml.org:/cvsroot/GCC_XML co gccxml
mkdir gccxml-build
cd gccxml-build
cmake ../gccxml -DCMAKE_INSTALL_PREFIX:PATH=/installation/path
make
make install
\end{verbatim}
The "-DC\_MAKE\_INSTALL\_PREFIX" option can be left off if you want to use "/usr/local" as the installation prefix.


\paragraph{Pyplusplus and Pygccxml: }
The homepage of {\tt pyplusplus} and {\tt pygccxml} projects is 
{\tt http://www.language-binding.net/pyplusplus/pyplusplus.html}. From the
download section \footnote{\tt https://sourceforge.net/project/showfiles.php?group\_id=118209}, 
get the files {\tt pygccxml-0.9.5.zip} and {\tt Py++-0.9.5.zip}.

\begin{verbatim}
unzip pygccxml-0.9.5.zip
cd pygccxml-0.9.5/
python setup.py build
python setup.py install --prefix=$HOME/soft
\end{verbatim}

\begin{verbatim}
unzip Py++-0.9.5.zip 
cd Py++-0.9.5/
python setup.py build
python setup.py install --prefix=$HOME/soft
\end{verbatim}

In your {\tt \$HOME/.bashrc} file, then add:
\begin{verbatim}
export PATH=PATH:$HOME/soft/bin/:/usr/lib/gcc/x86_64-redhat-linux/3.4.6/
export PYTHONPATH=$HOME/soft/lib/python2.4/site-packages/
\end{verbatim}

In a Python shell (obtained with the {\tt python} command), test the installation
of PyPlusPlus:
\begin{verbatim}
>>> import pyplusplus
\end{verbatim}

\subsection{Set up: Dell Precision 690, Linux Fedora Core 7, 64-bit}
This example installation has been performed on a Dell Precision 690 (Intel
Xeon bi-quad core 1.9~GHz, Linux Fedora Core 7, linux kernel 2.6.23.17-88.fc7).

The basic requirements are:
\begin{itemize}
\item Python 2.5 and its development library python2.5-dev
\item gcc (4.x)
\item gfortran (4.x)
\end{itemize}

\paragraph{SCons (make substitute):}
The scons package provided by Fedora is not up-to-date enough to link Fortran and C++ together and then rise an
error. The last version of scons is obtained at the homepage of the project ({\tt  http://www.scons.org/}).
From the download section \footnote{\tt http://sourceforge.net/project/showfiles.php?group\_id=30337}, 
get the stable file {\tt scons-0.98.5-1.noarch.rpm}.

\begin{verbatim}
 rpm -ivh scons-0.98.5-1.noarch.rpm
\end{verbatim}

\paragraph{Boost C++ Libraries:} {\tt yum install boost boost-devel} \\
(1.33.1-15.fc7 version installed)


\paragraph{Python dev:} {\tt yum install python-devel} \\
(2.5-15.fc7 version installed)

\paragraph{Subversion:} {\tt yum install subversion} \\
(1.4.4-1.fc7 version installed)

\paragraph{gccxml:}The homepage of {\tt gccxml} project is {\tt http://www.gccxml.org}. 
To install gccxml from the official CVS repository \footnote{\tt http://www.gccxml.org/HTML/Download.html}.

\begin{verbatim}
yum install cvs
\end{verbatim}
1.11.22-9.1.fc7 version installed

\begin{verbatim}
yum install cmake
\end{verbatim}
2.4.8-1.fc7 version installed

\begin{verbatim}
cvs -d :pserver:anoncvs@www.gccxml.org:/cvsroot/GCC_XML login
\end{verbatim}
(just press enter when prompted for a password)\\
Follow this command by checking out the source code:
\begin{verbatim}
cvs -d :pserver:anoncvs@www.gccxml.org:/cvsroot/GCC_XML co gccxml
mkdir gccxml-build
cd gccxml-build
cmake ../gccxml -DCMAKE_INSTALL_PREFIX:PATH=/installation/path
make
make install
\end{verbatim}
The "-DC\_MAKE\_INSTALL\_PREFIX" option can be left off if you want to use "/usr/local" as the installation prefix.


\paragraph{Pyplusplus and Pygccxml: }
The homepage of {\tt pyplusplus} and {\tt pygccxml} projects is 
{\tt http://www.language-binding.net/pyplusplus/pyplusplus.html}. From the
download section \footnote{\tt https://sourceforge.net/project/showfiles.php?group\_id=118209}, 
get the files {\tt pygccxml-0.9.5.zip} and {\tt Py++-0.9.5.zip}.

\begin{verbatim}
unzip pygccxml-0.9.5.zip
cd pygccxml-0.9.5/
python setup.py build
python setup.py install --prefix=$HOME/soft
\end{verbatim}

\begin{verbatim}
unzip Py++-0.9.5.zip 
cd Py++-0.9.5/
python setup.py build
python setup.py install --prefix=$HOME/soft
\end{verbatim}

In your {\tt \$HOME/.bashrc} file, then add:
\begin{verbatim}
export PATH=PATH:$HOME/soft/bin/:/usr/lib/gcc/x86_64-redhat-linux/3.4.6/
export PYTHONPATH=$HOME/soft/lib/python2.4/site-packages/
\end{verbatim}

In a Python shell (obtained with the {\tt python} command), test the installation
of PyPlusPlus:
\begin{verbatim}
>>> import pyplusplus
\end{verbatim}

\paragraph{g2c library: }

\begin{verbatim}
yum install g2clib-devel
\end{verbatim}
1.0.5-3.fc7 version installed


\subsection{Source download with subversion}

From the local {\tt \$HOME/soft/} directory, download the full PTools sources with subversion (use the {\it checkout} option):
\begin{verbatim}
svn co http://svn-lbt.ibpc.fr/svn/PTools/ptools ptools
\end{verbatim}

\begin{itemize}
\item for the first use, press {\it Enter} and then indicate your login and password
\item both login and password are stored (without encryption) in the {\tt \$HOME/.subversion} directory
\end{itemize}

PTools source updates are then obtained by:
\begin{verbatim}
svn update
\end{verbatim}
from the {\tt ptools/} or {\tt ptools/trunk} directories.


\subsection{Compilation}
From the main directory ({\tt trunk}) of the PTools project, create the Python/C++ interface:
\begin{verbatim}
python interface.py
\end{verbatim}

Compile then the library:
\begin{verbatim}
scons
\end{verbatim}

Note that {\tt scons -j2} compiles with two processors in parallel.

If scons complains about the g2c library, you may do (as root):
\begin{verbatim}
ln -s /usr/lib64/libg2c.so.0 /usr/lib64/libg2c.so
\end{verbatim}

In case of problem with the gfortran library, you should add directly to the search path (l.87)
of the SConstruct file the location of libgfortran files. For instance: 
\newline Initial search path:
\newline ["/usr/lib","/sw/lib","/usr/lib/gcc/x86\_64-redhat-linux/3.4.6/"]
\newline Add specific path for suse distribution:
\newline ["/usr/lib","/sw/lib","/usr/lib/gcc/x86\_64-redhat-linux/3.4.6/","/usr/lib64/gcc/x86\_64-suse-linux/4.1.2/"]

\subsection{Final test and further documentation}

In the {\tt Test} directory, one can test the compilation worked:
\begin{verbatim}
python unittest1.py
\end{verbatim}

The expected output is:
\begin{verbatim}
....... 
---------------------------------------------------------------------- 
Ran 7 tests in 0.813s 

OK 
\end{verbatim}

Further document may be obtained from the Trac server {\tt http://svn-lbt.ibpc.fr/PTools/wiki}. 
The server access is controled by the same login/password of the subversion server. The {\tt Timeline}
and {\tt Browse Source} sections are usually very usefull.

A {\tt README} file is also available on line 
\footnote{\tt http://svn-lbt.ibpc.fr/PTools/browser/ptools/trunk/Tutorial/README} 
or locally \footnote{\tt \$HOME/soft/ptools/trunk/Tutorial/README}.


\section{PTools library usages and capabilities}

\subsection{Directly from C++}

Source code may be parsed by an automatic documentation generator called 'Doxygen'.
This documentation may only help for the C++ part of the library.
after installing Doxygen, simply type 'doxygen' in the directory which contains the 'Doxyfile'.
Then look into the html/ directory and find the index.html file generated...
The most important objects and functions to manipulate pdb are explained in the following section.

\subsection{From Python through the C++ binding}

If PTools has been installed in the {\tt \$HOME/soft/ptools/branches/1.0rc/} directory, 
declare it in your PYTHONPATH :

\begin{verbatim}
export PYTHONPATH=$PYTHONPATH:$HOME/soft/ptools/branches/1.0rc/
\end{verbatim}
or add this line at the end of your {\tt \$HOME/.bashrc} file.


From the Python interpreter or in a Python script, first load the PTools library:
\begin{verbatim}
from ptools import *
\end{verbatim}


\subsubsection{Rigidbody objects}

\paragraph{Load PDB file into a rigidbody object.}
\begin{verbatim}
pdb = Rigidbody("1BTA.pdb")
\end{verbatim}


\paragraph{Number of atoms}
\begin{verbatim}
pdb.Size()
\end{verbatim}


\paragraph{Maximum distance from geometric center} in \AA.
\begin{verbatim}
pdb.Radius()
\end{verbatim}


\paragraph{Radius of gyration} in \AA.
\begin{verbatim}
pdb.RadiusGyration()
\end{verbatim}


\paragraph{Structure translation.}
First create a translation vector as a Coord3D object (for instance 5, 0, 1):
\begin{verbatim}
trans = Coord3D(5, 0, 1)
\end{verbatim}
Then, apply the translation vector:
\begin{verbatim}
pdb.Translate(trans)
\end{verbatim}


\paragraph{Center structure to origin.}
\begin{verbatim}
pdb.CenterToOrigin()
\end{verbatim}


\paragraph{Save structure as PDB file.}
\begin{verbatim}
WritePDB(pdb, "1BTA_centered.pdb")
\end{verbatim}


\subsubsection{Selection objects}

\paragraph{Selection of CA atoms.}
\begin{verbatim}
sel_ca = pdb.CA()
\end{verbatim}


\paragraph{Selection of backbone atoms.}
\begin{verbatim}
sel_bkbn = pdb.Backbone()
\end{verbatim}


\paragraph{Selection by chain.}
\begin{verbatim}
sel_chainA = pdb.SelectChainId("A")
sel_chainB = pdb.SelectChainId("B")
\end{verbatim}


\paragraph{Selection of a range of residues.}
\begin{verbatim}
sel_res = pdb.SelectResRange(10, 20)
\end{verbatim}


\paragraph{Selection number of atoms.}
\begin{verbatim}
sel_res.Size()
\end{verbatim}



\paragraph{Selection reunion.}
\begin{verbatim}
sel_chainAB = sel_chainA | sel_chainB
\end{verbatim}
or directly
\begin{verbatim}
sel_chainAB = pdb.SelectChainId("A") | pdb.SelectChainId("B")
\end{verbatim}


\paragraph{Selection to rigidbody conversion.}
\begin{verbatim}
ca_trace = sel_ca.CreateRigid()
\end{verbatim}

\subsubsection{atom object}

\paragraph{copy atom from rigidbody object.}
\begin{verbatim}
at = pdb.CopyAtom(2)
\end{verbatim}

\paragraph{Set new coordinates}
\begin{verbatim}
new_XYZ = Coord3D(2.1,3.9,5.5)
at.SetCoords(new_XYZ)
\end{verbatim}

\paragraph{translate atom}
\begin{verbatim}
vector = Coord3D(1.0,1.0,1.0)
at.Translate(vector)
\end{verbatim}


\paragraph{print atom in pdb-like format}
\begin{verbatim}
at.ToPdbString()
\end{verbatim}

\paragraph{Get atom properties}
\begin{verbatim}
at.GetType()
at.GetResidType()
at.GetAtomCharge()
at.GetChainId()
at.GetResidId()
at.GetAtomId()
at.GetExtra()
\end{verbatim}

\paragraph{Set atom properties}
\begin{verbatim}
at.SetType()
at.SetResidType()
at.SetAtomCharge()
at.SetChainId()
at.SetResidId()
at.SetAtomId()
at.SetExtra()
\end{verbatim}

\section{Docking with PTools: ATTRACT}

This part is illustrated by the docking of 1CGI complex.

\subsection{Protein--protein complex: 1CGI}

The 1CGI complex is made of two partners. Chain A: 245 residues, 1799 atoms and chain I: 56 residues, 440 atoms.

\subsubsection{Extraction of the docking partners}

Before docking, one has to separate both partners. This is possible with visualisation
software such as Pymol \footnote{\tt http://pymol.sourceforge.net/} or VMD \footnote{\tt http://www.ks.uiuc.edu/Research/vmd/}, 
and also directly with the PTools library.

Within the Python interpreter, first load the PTools library:
\begin{verbatim}
from ptools import *
\end{verbatim}

Read the PDB file 1CGI.pdb:
\begin{verbatim}
pdb=Rigidbody("1CGI.pdb")
\end{verbatim}

The chain selection allows the separation between chain A and B.
\begin{verbatim}
selectE=pdb.SelectChainId("E")
selectI=pdb.SelectChainId("I")
\end{verbatim}

Create both chains as independant rigid bodys and save them in PDB file. The biggest 
protein is define as the receptor (chain E) and the smallest as the ligand (chain I):

\begin{verbatim}
protE=selectE.CreateRigid()
protI=selectI.CreateRigid()
WritePDB(protE,"receptor.pdb")
WritePDB(protI,"ligand.pdb")
\end{verbatim}
Or more quickly:
\begin{verbatim}
WritePDB(selectE.CreateRigid(),"receptot.pdb")
WritePDB(selectI.CreateRigid(),"ligand.pdb")
\end{verbatim}

\subsubsection{Coarse grain reduction}

This step translates all atom molecule into coarse grain (reduced) molecule for a further docking. 

For the receptor: 
\begin{verbatim}
./reduce.py --prot receptor.pdb > receptor.red
\end{verbatim}
{\tt receptor.red} contains 522 beads.\\

For the ligand:
\begin{verbatim}
./reduce.py --prot ligand.pdb > ligand.red
\end{verbatim}
{\tt ligand.red} 126 beads. \\

The {\tt reduce.py} script required the following parameters:

\begin{itemize}
\item {\tt --prot} or {\tt --dna} option, specifies the type of molecule to reduce (protein or DNA)
\item an input all-atom PDB file, for instance {\tt receptor.pdb}
\item an output coarse grain file, for instance {\tt receptor.red}
\end{itemize}

This script also needs definition files:

\begin{itemize}
\item bead topologie files ({\tt at2cg.prot.dat} for protein reduction and {\tt at2cg.dna.dat} for DNA reduction )
\item forcefield parameter file ({\tt ff\_param.dat})
\item filetype conversion file ({\tt type\_conversion.dat})
\end{itemize}

The reduced files generated are PDB-like structure files that can be read by most visualisation
programs (rasmol, pymol, to test VMD). 
Always, visualize both all-atom and coarse grain structures to check the reduction worked properly.


\begin{figure}[htbp]
\center
{\textbf A}
\includegraphics*[width=0.30\textwidth]{img/1CGI_receptor.png}
\hspace*{2cm}
{\textbf B}
\includegraphics*[width=0.25\textwidth]{img/1CGI_ligand.png}
\caption{All-atom (green sticks) and reduced (red spheres) representation of both proteins in 1CGI. Receptor (A) and ligand (B).}
\end{figure}

\subsubsection{Initial ligand positions}

The systematic docking simulation uses starting points placed around the
receptor.  The Python script {\tt translate.py} employs a slightly modified
Shrake and Rupley \cite{shrake1973} method to define starting positions
from receptor surface.  The surface generation fonctions are implemented in
the PTools library. The script first reads the coarse grain (reduced)
receptor and ligand files, then generates a grid of points at a certain
distance from the receptor and outputs the grid with a given density.

Note: a density option ({\tt -d}) controls the minimum distance between starting
points (in \AA). The default value is 10.0~\AA. 

In the present case:
\begin{verbatim}
./translate.py receptor.red ligand.red > translation.dat
\end{verbatim}

The visualisation of the starting points may be viewed with any visualisation software by renaming {\tt translation.dat} in {\tt translation.pdb}.
Then, remove the first line of {\tt translation.pdb} (indicated the total number of starting points).

\begin{figure}[htbp]
\center
\includegraphics*[width=0.4\textwidth]{img/1CGI_translation.png}
\caption{(All-atom) receptor in green sticks and starting points as orange spheres.}
\end{figure}

For each position in translation (each {\tt ATOM} line of the file {\tt translation.dat}), 
there are 258 associated rotations defined in the file {\tt rotation.dat}. 

\subsubsection{ATTRACT parameters}

ATTRACT parameters are found in the file {\tt attract.inp}. A typical configuration file is:
\begin{verbatim}
    6    0    0
 -34.32940  38.75490  -3.66956   0.00050
  100  2  1  1  0  0  0  0  1  3000.00   
  100  2  1  1  0  0  0  0  1  1000.00   
  100  2  1  1  0  0  0  0  0   500.00   
  100  2  1  1  0  0  0  0  0    50.00   
  100  2  1  1  0  0  0  0  0    50.00   
  300  2  1  1  0  0  0  0  0    50.00
\end{verbatim}

The first line indicates the number of minimisations performed by ATTRACT for each starting position. 
The last six lines are the caracteristics of each minimisation. The first column is the number of steps before the minimisation stops. 
The last column is the square of the cutoff distance for the calculation of the interaction energy between both partners.

\paragraph{Note:} Columns with zeros or ones should not be modfied, as well as the second line.

\subsubsection{Initial docking simulation}

A docking simulation with ATTRACT requires:
\begin{itemize}
\item a coarse grain receptor (fixed partner) file ({\tt receptor.red})
\item a coarse grain (mobile partner) file ({\tt ligand.red})
\item the ATTRACT program ({\tt  Attract.py})
\item the coarse grain parameters ({\tt aminon.par})
\item translational starting points ({\tt translation.dat})
\item rotations performed for each translational starting point ({\tt rotation.dat})
\item docking parameters ({\tt attract.inp})
\end{itemize}

ATTRACT can be used with different options:
\begin{itemize}
\item -s, performs one single serie of minimisations with the ligand in its initial position.
\item --ref=, provides a ligand pdb file as a reference. After each docking, the RMSD is calculated between this reference structure and the simulated ligand.
\end{itemize}

A single ATTRACT simulation may thus be obtained by:
\begin{verbatim}
./Attract.py receptor.red ligand.red --ref=ligand.red -s > single.att
\end{verbatim}

The first pdb file provided must be the receptor file (and the second the ligand).
The content of the output file {\tt single.att} is the following:

\newpage
\linenumbers
\begin{verbatim}
**********************************************************************
**                ATTRACT  (Python edition)                         **
**                version: 0.3                                      **
********************************************************************** 
2008-10-27 15:21:30.433798 ( Monday October 27 2008, 15:21 )
6 series of minimizations
rstk =  0.0005
Receptor (fixed) receptor.red  has 522 particules
Ligand (mobile) ligand.red  has 126 particules
using reference file: ligand.red
Single mode
@@@@@@@ Translation nb 1 @@@@@@@
----- Rotation nb 1 -----
{{ minimization nb 1 of 6 ; cutoff= 54.77 (A) ; maxiter= 100
number of free variables for the minimizer: 6
STOP, max iterations reached                                |  100 iterations
{{ minimization nb 2 of 6 ; cutoff= 31.62 (A) ; maxiter= 100
number of free variables for the minimizer: 6
CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH             |  1 iterations
{{ minimization nb 3 of 6 ; cutoff= 22.36 (A) ; maxiter= 100
number of free variables for the minimizer: 6
CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH             |  11 iterations
{{ minimization nb 4 of 6 ; cutoff= 7.07 (A) ; maxiter= 100
number of free variables for the minimizer: 6
CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH             |  94 iterations
{{ minimization nb 5 of 6 ; cutoff= 7.07 (A) ; maxiter= 100
number of free variables for the minimizer: 6
CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH             |  35 iterations
{{ minimization nb 6 of 6 ; cutoff= 7.07 (A) ; maxiter= 300
number of free variables for the minimizer: 6
CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH             |  1 iterations
      Trans    Rot          Ener    RmsdCA_ref
==        1      1   -57.4385916 1.10578043721
### MAT BEGIN
MAT        0.9978729      0.0425669     -0.0493744      0.3166520 
MAT       -0.0440559      0.9985943     -0.0294718      2.1806519 
MAT        0.0480505      0.0315843      0.9983454     -2.5887244 
MAT        0.0000000      0.0000000      0.0000000      1.0000000 
### MAT END

Finished at:  Monday October 27 2008, 15:21
\end{verbatim}
\nolinenumbers

\begin{itemize}
\item{\bf line 5:} starting date and time of the simulation
\item{\bf lines 14--16:} minimization 1. Details of minimization number, cutoff in \AA\ and maximum number of iterations (line~14). 
Number of variables (line~15). End of minimization (line~16), either convergence is achieved (iteration number is specified), either maximum number of steps is reached.
\item{\bf lines 17--19:} minimization 2.
\item{\bf lines 20--22:} minimization 3.
\item{\bf lines 23--25:} minimization 4.
\item{\bf lines 26--28:} minimization 5.
\item{\bf lines 29--31:} minimization 6.
\item{\bf lines 31--32:} final result after the 6 minimizations. With a single minimization, 
the default translation ({\tt Trans}) is 1 and the default rotation ({\tt Rot}) is 1. 
Energy is given, as well as the C$_{\alpha}$-RMSD (in \AA) if the {\tt --ref} option is specified.
\item{\bf lines 34--39:} rotation/translation matrix of the ligand compared to its initial position.
\item{\bf line 41:} end date and time of the simulation.
\end{itemize}

Here, the final energy is -57.44~RT unit and the RMSD is 1.10~\AA, that is pretty close from initial position (RMSD would be 0).

For a full systematic docking in the translational and rotational space (using both {\tt translation.dat}
and {\tt rotation.dat} files):
\begin{verbatim}
./Attract.py receptor.red ligand.red --ref=ligand.red > docking.att &
\end{verbatim}

The output file {\tt docking.att} contains all informations on the docking simulation. 
It contains ouput of all series of minimizations (with the specification of translation and rotation number).

For the 1CGI system, the systematic docking tooks 13 houres on one processor of a 64~bit Intel Xeon 1.86 GHz 2 Go RAM computer.
The output file {\tt docking.att} is roughly 77~Mo.

\subsubsection{Docking output analysis}

The 10 best geometries found during the docking simulation can be listed with

\begin{verbatim}
cat docking.att | egrep -e "^==" | sort -n -k4 | head
\end{verbatim}

For the previsous docking simulation of 1CGI, it gives:

\begin{verbatim}
==      181    114   -57.4411654 1.10599878835
==       75    210   -57.4408805 1.10386797285
==      136    240   -57.4408059 1.10497880686
==      128    115   -57.4406227  1.1065086208
==       72    253   -57.4403268 1.10469314189
==      136    184   -57.4403213 1.10354544969
==      128     13   -57.4402706 1.10351871162
==       73    147   -57.4402011 1.10626548925
==      133    149   -57.4401622  1.1059746571
==      136     50   -57.4401590 1.10652040931
\end{verbatim}

With each column meaning:
\begin{enumerate}
\item tag characters ({\tt ==}) to quickly find the result of each set of minimizations
\item translation number (starts at 1)
\item rotation number (starts at 1)
\item final energy of the complex in RT unit
\item final RMSD in \AA, if the {\tt --ref} option is provided.
\end{enumerate}

Any simulated ligand structure can be extracted with the script {\tt Extract.py}:

\begin{verbatim}
./Extract.py docking.att ligand.red 181 114 > ligand_1.red
\end{verbatim}

with the parameters:
\begin{itemize}
\item the ouput file of the docking simulation ({\tt docking.att})
\item the inital ligand file ({\tt ligand.red})
\item a translation number ({\tt 181})
\item a rotation index ({\tt 114})
\item an output ligand file ({\tt ligand_1.red})
\end{itemize}


TO ADD : visualization with Pymol




In case you know the experimental structure of your system (as in this example), it is possible to calculate the
interface rmsd and the native fraction as defined by the CAPRI contest \footnote{\tt http://capri.ebi.ac.uk}
using the following scripts:


\begin{verbatim}
irmsd.py 1F34_A.cg.pdb 1F34_B.cg.pdb 1F34_dock.pdb
fnat.py 1F34_A.cg.pdb 1F34_B.cg.pdb 1F34_dock.pdb
\end{verbatim}

with the parameters:
\begin{itemize}
\item the receptor file (1F34\_A.cg.pdb)
\item the initial ligand file (1F34\_B.cg.pdb)
\item the output ligand file (1F34\_dock.pdb)
\end{itemize}

Our clustering algorithm implemented in cluster.py can rapidly filter near identical solutions without requiring a preselected number of desired clusters.
The algorithm is based on rmsd comparison and an additional energy criterion could be included (see script options).

\begin{verbatim}
cluster.py 1F34_dock.att 1F34_B.cg.pdb > 1F34_dock.clust
\end{verbatim}

with the parameters:
\begin{itemize}
\item an ouput of the docking simulation (1F34\_dock.att)
\item the initial ligand file (1F34\_B.cg.pdb)
\item an output cluster file (1F34\_B.cg.pdb)
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Misc. tips and tricks}


\subsection{Troubleshooting}

\subsubsection{Bus error}
On Mac OS, the command "import ptools" can lead to a "bus error" error message. This happens with MacPorts or 
fink versions of python. Solution: use the python provided with the system instead (/usr/bin/python)



\begin{thebibliography}{99}

\bibitem{shrake1973} A. Shrake, and J.A. Rupley, 
{\it Environment and exposure to solvent of protein atoms. Lysozyme and
isulin}, 
Journal of Molecular Biology, {\bf 79}:351-364, 1973.

\end{thebibliography}
\end{document}


		
